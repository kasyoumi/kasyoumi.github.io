<!doctype html><html><head><title>简单的 GC 垃圾回收知识</title><base href="../"><meta id="root-path" root-path="../"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes,minimum-scale=1,maximum-scale=5"><meta charset="UTF-8"><link rel="icon" href="lib/media/favicon.png"><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/supported-plugins.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="stylesheet" href="lib/styles/other-plugins.css"><link rel="stylesheet" href="lib/styles/snippets.css"><link rel="stylesheet" href="lib/styles/global-variable-styles.css"><link rel="stylesheet" href="lib/styles/main-styles.css"><script src="lib/scripts/pixi.js"></script><script src="lib/scripts/webpage.js"></script><include src="lib/html/custom-head-content.html"></include></head><body class="loading theme-dark"><div class="webpage-container"><div class="sidebar-left sidebar"><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div></div></div></div><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div></div><div class="document-container show"><div class="markdown-preview-view markdown-rendered allow-fold-headings"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="markdown-preview-pusher" style="height:.1px;margin-bottom:0;width:1px"></div><div class="mod-header"><h1 id="inline-title"><p>简单的 GC 垃圾回收知识</p></h1></div><div class="heading-wrapper"><h2 data-heading="堆内存与栈内存" class="heading" id="堆内存与栈内存"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>堆内存与栈内存<div class="heading-after">...</div></h2><div class="heading-children"><div><p>垃圾一般就是指没用了的对象。对象的值一般存储在堆空间中。而基础类型、对象的引用以及大小确定的一些结构类型存储在栈空间中，函数执行就是靠不停的进出方法栈，每执行一步，就会退出一个栈，清理掉这些栈空间数据，切换到下一个栈。</p></div><div><p>也即对象的引用被销毁掉了，那么堆空间对象的值就变成无用数据了。所以通常我们讲垃圾回收都是在针对堆空间中的对象值。</p></div><div><p>在c/c++中，对象提供了析构函数让我们手动释放资源。而在java等托管语言中，有虚拟机提供了垃圾回收机制，帮我们处理这些在堆内存中没用了的对象（垃圾）。</p></div></div></div><div class="heading-wrapper"><h2 data-heading="如何识别标记垃圾" class="heading" id="如何识别标记垃圾"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>如何识别标记垃圾<div class="heading-after">...</div></h2><div class="heading-children"><div><p>那接下来的重点就是虚拟机如何讲对象识别为垃圾，这样虚拟机才能回收垃圾。一般有两种方法，引用计数和根搜索算法。</p></div><div class="heading-wrapper"><h3 data-heading="引用计数算法" class="heading" id="引用计数算法"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>引用计数算法<div class="heading-after">...</div></h3><div class="heading-children"><div><p>顾名思义，一个对象被创建后，我们计数这个对象被引用的次数。如果引用次数为0，则说明这个对象不再被使用了。</p></div><div><p>同时也引出了一个巨大的问题，当出现两个对象互相引用时，引用计数永远不会到达0。那么就造成了内存泄漏。所以引用计数算法现在已经退隐江湖了，只在很早期的虚拟机中出现过。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="根搜索算法" class="heading" id="根搜索算法"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>根搜索算法<div class="heading-after">...</div></h3><div class="heading-children"><div><p>根搜索算法也很容易理解。我们从一个“根对象”开始出发，想象出一个图状结构，形成一条条连接的引用链。不在这些引用链中的对象，就是垃圾对象。</p></div><div><p>核心思想就是找到不可达的对象，这些不可达的对象自然就是垃圾对象了。</p></div><div><p><span alt="image-2023_09_25_17_07_03.png" src="lib\media\image-2023_09_25_17_07_03.png" class="internal-embed media-embed image-embed is-loaded"><img alt="image-2023_09_25_17_07_03.png" src="lib\media\image-2023_09_25_17_07_03.png"></span></p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="如何回收垃圾" class="heading" id="如何回收垃圾"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>如何回收垃圾<div class="heading-after">...</div></h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="回收步骤" class="heading" id="回收步骤"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>回收步骤<div class="heading-after">...</div></h3><div class="heading-children"><div><blockquote><p>垃圾回收有很多算法，本文仅简单概述常见的，算法具体逻辑及实现可以百度看看其它文章。</p></blockquote></div><div><p>首先是回收标记的垃圾对象。当我们回收完毕后，内存空间可能会出现不连续，造成空间浪费。垃圾回收器就需要对内存碎片进行整理。所以垃圾回收就是再做：标记-回收-整理，三个步骤。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="回收算法" class="heading" id="回收算法"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>回收算法<div class="heading-after">...</div></h3><div class="heading-children"><div><p>总结出规律，聪明的程序员就发明了高性能的整理回收算法。称之为 <code>复制算法 Scavenge</code> 。具体逻辑就是将内存空间对半分，回收时，将存活的对象复制到另一半空间中。最终一半空间是非活动对象，一半空间全是存活对象。垃圾回收器可以轻松的将一半空间清除，使之变为空闲区域。</p></div></div></div><div class="heading-wrapper"><h3 data-heading="垃圾分代" class="heading" id="垃圾分代"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>垃圾分代<div class="heading-after">...</div></h3><div class="heading-children"><div><p>只用一种算法提升还不够大，程序员们就又针对空间使用规律。提出了对象分代的理念。区分长命的对象和短命的对象。常见的一种区分方式是：经过几轮垃圾回收还存活的，就是长命对象。反之则为短命对象。分别称之为新生代，老年代。</p></div><div><p>然后针对不同类别的对象实行不同的回收算法，有了针对性，也就节省了很多性能和空间开销。</p></div></div></div></div></div><div class="heading-wrapper"><h2 data-heading="扩展知识" class="heading" id="扩展知识"><div class="heading-before"></div><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>扩展知识<div class="heading-after">...</div></h2><div class="heading-children"><div><p>除了这些通用的垃圾回收机制外。不同的编程语言虚拟机还提供了不同的特性。例如 java 虚拟机就提供了”强引用、软引用、弱引用和虚引用"特性。增强我们对对象的生命周期控制，影响垃圾回收器的工作。</p></div><div><p>可以看其它大佬的文章了解这些知识：<a data-tooltip-position="top" aria-label="https://juejin.cn/post/6844903665241686029" rel="noopener" class="external-link" href="https://juejin.cn/post/6844903665241686029" target="_blank">理解Java的强引用、软引用、弱引用和虚引用</a></p></div><div><p>所以具体垃圾回收器，还是需要具体学习。不过知道这些知识也够用了～</p></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display:none"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#简单的_GC_垃圾回收知识"><div class="tree-item-contents heading-link" heading-name="简单的_GC_垃圾回收知识"><span class="tree-item-title">简单的 GC 垃圾回收知识</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#堆内存与栈内存"><div class="tree-item-contents heading-link" heading-name="堆内存与栈内存"><span class="tree-item-title">堆内存与栈内存</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#如何识别标记垃圾"><div class="tree-item-contents heading-link" heading-name="如何识别标记垃圾"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">如何识别标记垃圾</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#引用计数算法"><div class="tree-item-contents heading-link" heading-name="引用计数算法"><span class="tree-item-title">引用计数算法</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#根搜索算法"><div class="tree-item-contents heading-link" heading-name="根搜索算法"><span class="tree-item-title">根搜索算法</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#如何回收垃圾"><div class="tree-item-contents heading-link" heading-name="如何回收垃圾"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">如何回收垃圾</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#回收步骤"><div class="tree-item-contents heading-link" heading-name="回收步骤"><span class="tree-item-title">回收步骤</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#回收算法"><div class="tree-item-contents heading-link" heading-name="回收算法"><span class="tree-item-title">回收算法</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#垃圾分代"><div class="tree-item-contents heading-link" heading-name="垃圾分代"><span class="tree-item-title">垃圾分代</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="article\简单的-gc-垃圾回收知识.html#扩展知识"><div class="tree-item-contents heading-link" heading-name="扩展知识"><span class="tree-item-title">扩展知识</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div></div></div></div></div></body></html>